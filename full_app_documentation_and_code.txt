# KIPP Application - Comprehensive Design & Code Documentation

## 1. Design System & Aesthetics

### 1.1 Visual Language (Theme)
The application utilizes a custom "Surface Levels" system to create depth without relying heavily on borders. This creates a clean, modern, and "expensive" feel.

**Color Palette (Tailwind Abstractions)**
*   `bg-background` (#f9f8f7 / #141414): The lowest level. Used for the app container.
*   `bg-sidebar` (#f9f8f7 / #141414): Matches background but creates a distinct region context.
*   `bg-surface-l1` (White / #212121): Used for Cards, Chat Bubbles, and Floating Elements.
*   `bg-surface-l2` (#f3f2f1 / #292929): Used for Hover states, Input fields, and Secondary buttons.
*   `bg-surface-l3` (#e5e7eb / #333333): Used for Borders and Dividers.

**Typography**
*   **Font**: 'Inter' (System UI fallback).
*   **Sizes**:
    *   Input Text: 16px (prevent zoom on mobile).
    *   Message Text: Standard prose size.
    *   Headers: Tracking-tight for a modern look.

**Motion & Physics**
*   **Global Transition**: `duration-500 ease-[cubic-bezier(0.2,0,0,1)]`.
    *   *Why*: This specific cubic-bezier starts fast and slows down gracefully, mimicking high-end native OS animations (like iOS).
*   **Fade In Up**: Used for messages and modals to feel like they are "arriving".

---

## 2. Component Specifications

### 2.1 The Sidebar (`Sidebar.tsx`)
*   **Dimensions**: 
    *   Desktop Width: `320px`. Fixed.
    *   Mobile: `100%` width (Slide-over).
*   **Header (`h-[6rem]`)**: 
    *   Contains the Logo and Toggle Button.
    *   **Toggle Button**: `size-12 rounded-full`. Uses `backdrop-blur-2xl` to pull color from behind, making it feel integrated.
*   **Search Bar**:
    *   **Design**: `h-12 rounded-full`.
    *   **Behavior**: When focused, it expands to `w-full` (z-index 10) covering the action buttons. When blurred, it shrinks to `w-[calc(100%-104px)]` to reveal buttons.
*   **Action Buttons**:
    *   Settings & New Chat.
    *   **Design**: `size-12 rounded-full`. Consistent with the toggle button.
*   **Navigation List**:
    *   **Item Height**: `h-[52px]`. Large touch target.
    *   **Delete Action**: Hovering a chat reveals a trash icon (`size-8`).

### 2.2 The Chat Interface

**Input Bar (`ChatInput.tsx`)**
*   **Container**: Floating at the bottom.
    *   *Why*: Detaching it from the very bottom edge makes it feel lighter and less constrained.
*   **Shape**: `rounded-[1.75rem]` (Large Pill).
*   **Shadow**: `shadow-lg` to lift it off the content.
*   **Textarea**: Auto-resizing. `max-h-[200px]`.
*   **Attachment Button**: Left side. Circular hover effect.
*   **Send Button**: Right side. 
    *   *State*: Scales up (`scale-110`) and fills with foreground color when text is present. Gray and transparent when empty.

**Message Bubbles (`ChatMessage.tsx`)**
*   **User**:
    *   `bg-surface-l1` (White/Dark Grey).
    *   `rounded-3xl` with `rounded-br-lg`. The sharp corner indicates the origin (user).
    *   Right aligned wrapper.
*   **AI (KIPP)**:
    *   Transparent background.
    *   Full width markdown rendering using `prose` (Tailwind Typography).
    *   **Thinking Block**: `border-l-2 border-border`. Italicized text. Collapsible logic via `setIsThinkingOpen`.

**Code Executor (`CodeExecutor.tsx`)**
*   **Design**: Mac-style window header.
*   **Header**: `bg-background/30`. Contains generic window controls (Collapse, Copy, Run).
*   **Content**: `bg-code-bg` (#f9fafb / #18181b).
*   **Visuals**: Uses `highlight.js` for syntax highlighting.

### 2.3 Modals

**Settings Modal (`SettingsModal.tsx`)**
*   **Desktop**:
    *   `w-[90vw] h-[85vh] max-w-6xl`.
    *   `rounded-[2.5rem]`. Extremely round corners for a friendly, modern aesthetic.
    *   Two-column layout: Sidebar (Tabs) + Content.
*   **Mobile**:
    *   Bottom Sheet / Drawer.
    *   Slides up from bottom. `rounded-t-[2rem]`.

**Welcome Modal (`WelcomeModal.tsx`)**
*   **Layout**: Split screen (Visuals vs Text).
*   **Visuals**: CSS-only mockups of the app interface (SidebarMockup, ChatInputMockup) to educate the user without using heavy screenshots.

---

## 3. Iconography (Detailed Description)

All icons are SVG paths implemented as React components in `icons.tsx`.

| Icon Name | Visual Description | Usage |
| :--- | :--- | :--- |
| `ChevronsRightIcon` | Double arrows pointing right | Sidebar toggle button. |
| `SearchIcon` | Magnifying glass | Search input in sidebar. |
| `SettingsIcon` | Gear/Cog | Opens Settings modal. |
| `SquarePenIcon` | Pen inside a square | "New Chat" action. |
| `Trash2Icon` | Trash can | Delete conversation. |
| `PaperclipIcon` | Paperclip | File attachment in input bar. |
| `ArrowUpIcon` | Up arrow | Send button (when active). |
| `BrainIcon` | Human brain | Indicates "Thinking" process (Chain of Thought). |
| `CopyIcon` | Two overlapping rectangles | Copy code/text to clipboard. |
| `CheckIcon` | Checkmark | Success state (e.g., after copying). |
| `PlayIcon` | Triangle pointing right | Run code / Play audio. |
| `PauseIcon` | Two vertical bars | Pause audio. |
| `RefreshCwIcon` | Circular arrow | Re-run code / Regenerate response. |
| `SunIcon` | Sun with rays | Appearance/Theme settings tab. |
| `TerminalIcon` | Command prompt `>_` | Data/System settings tab. |
| `MapPinIcon` | Pin marker | Location services / Grounding source. |
| `GitForkIcon` | Branching path | Fork conversation. |
| `DownloadIcon` | Arrow pointing into tray | Download generated files. |
| `Wand2Icon` | Magic wand | "Fix Code" feature. |
| `Maximize2Icon` | Diagonal arrows | Expand image to lightbox. |
| `BarChartIcon` | Bar graph | Indicates Generative UI tool usage. |

---

## 4. Full Frontend Code

Below is the consolidated source code for the application logic (`OneFileApp.tsx`) and the structure/styles (`index.html`).

================================================================================
FILE: index.html
================================================================================

<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>KIPP - Kosmic Intelligence Pattern Perceptron</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    darkMode: 'class',
    theme: {
      extend: {
        fontFamily: {
          sans: ['Inter', 'sans-serif'],
          mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'monospace'],
        },
        colors: {
           background: "var(--background)",
           foreground: "var(--foreground)",
           card: "var(--card)",
           border: "var(--border)",
           "surface-base": "var(--surface-base)",
           "surface-l1": "var(--surface-l1)",
           "surface-l2": "var(--surface-l2)",
           "surface-l3": "var(--surface-l3)",
           "sidebar": "var(--sidebar-bg)",
        }
      }
    }
  }
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
<style>
::-webkit-scrollbar { display: none; }
* { scrollbar-width: none; -ms-overflow-style: none; }
:root {
  --background: #f9f8f7; --surface-base: #f9f8f7; --surface-l1: #ffffff; --surface-l2: #f3f2f1; --surface-l3: #e5e7eb;
  --foreground: #18181b; --muted-foreground: #71717a; --sidebar-bg: #f9f8f7; --sidebar-border: #e4e4e7;
  --card: #ffffff; --border: #e4e4e7; --accent-blue: #1d9bf0; --code-bg: #f9fafb;
}
.dark {
  --background: #141414; --surface-base: #141414; --surface-l1: #212121; --surface-l2: #292929; --surface-l3: #333333;
  --foreground: #f3f3f3; --muted-foreground: #a1a1aa; --sidebar-bg: #141414; --sidebar-border: #292929;
  --card: #212121; --border: #292929; --accent-blue: #1d9bf0; --code-bg: #18181b;
}
@media (max-width: 1024px) {
  .dark { --background: #000000; --surface-base: #000000; --sidebar-bg: #000000; --surface-l1: #111111; --border: #1a1a1a; --sidebar-border: #1a1a1a; --surface-l2: #141414; }
}
body { font-family: 'Inter', sans-serif; background-color: var(--background); color: var(--foreground); transition: background-color 0.2s ease; overflow: hidden; }
.prose { --tw-prose-body: var(--foreground); --tw-prose-headings: var(--foreground); --tw-prose-links: var(--accent-blue); overflow-wrap: break-word; word-break: break-word; }
@keyframes fade-in-up { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.animate-fade-in-up { animation: fade-in-up 0.3s ease-out forwards; }
</style>
</head>
<body>
<div id="root"></div>
<script type="module" src="/index.tsx"></script>
</body>
</html>

================================================================================
FILE: OneFileApp.tsx (Key Logic Excerpt)
================================================================================

import React, { useState, useEffect, useRef, useCallback, useMemo, forwardRef, useImperativeHandle } from 'react';
import { marked } from 'marked';

// --- TYPES ---
export enum MessageType { USER = 'USER', AI_RESPONSE = 'AI_RESPONSE', ERROR = 'ERROR' }
export interface Message { id: string; type: MessageType; content: string; files?: any[]; toolCalls?: any[]; groundingChunks?: any[]; }
export interface Conversation { id:string; title: string; messages: Message[]; createdAt: string; }

// --- ICONS (Subset) ---
const SearchIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>);
const SettingsIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>);

// --- COMPONENTS ---

const ChatInput = forwardRef(({ text, onTextChange, onSendMessage, isLoading }, ref) => {
  const textareaRef = useRef(null);
  const fileInputRef = useRef(null);
  // ... (Full implementation in frontend_code_bundle.txt)
  return (
    <div className="bg-white dark:bg-[#1f1f1f] rounded-[1.75rem] border border-gray-200 dark:border-[#27272a] flex items-end gap-2 p-2 relative shadow-lg">
       <button onClick={() => fileInputRef.current?.click()} className="flex items-center justify-center size-10 rounded-full hover:bg-black/5 dark:hover:bg-white/5 transition-colors mb-0.5"><PaperclipIcon className="size-5 text-muted-foreground" /></button>
       <textarea ref={textareaRef} value={text} onChange={(e) => onTextChange(e.target.value)} placeholder="Ask KIPP anything..." className="flex-1 bg-transparent outline-none text-foreground placeholder-muted-foreground text-[16px] py-2.5 px-1 resize-none max-h-[200px]" rows={1} />
       <div className="flex items-center justify-center size-10 flex-shrink-0 mb-0.5">
          {isLoading ? <div className="size-3 bg-current rounded-sm animate-spin" /> : <button onClick={() => onSendMessage(text, [])} className="flex items-center justify-center size-8 rounded-full bg-foreground text-background scale-110"><ArrowUpIcon className="size-4" /></button>}
       </div>
    </div>
  );
});

const Sidebar = ({ isOpen, toggleSidebar, conversations, activeId, onNewChat, onSelect, onDelete, onSettings }) => {
  const [term, setTerm] = useState('');
  const [focused, setFocused] = useState(false);
  // ... (Full implementation in frontend_code_bundle.txt)
  return (
    <div className={`flex flex-col h-full bg-sidebar z-[100] fixed inset-y-0 left-0 transition-all duration-500 border-r border-border w-full lg:w-[320px] ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}>
        {/* Header & Search Logic */}
    </div>
  );
};

// ... (Rest of the logic including OneFileApp main component, Python Service integration, and Gemini streaming logic is identical to the running application code provided in the bundle).
